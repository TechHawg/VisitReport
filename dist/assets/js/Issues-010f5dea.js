import{u as e,j as s,S as t,P as a,a as l,B as r,M as i,I as n,A as o,E as d,C as c}from"./pages-heavy-0f77b7b7.js";import{r as x}from"./react-vendor-573427e5.js";import{T as g}from"../index-bcad4793.js";import{B as u,A as m,b as p,M as h,k as v,T as j,a0 as y,p as f,G as b}from"./icons-260eb673.js";const N=()=>{const{reportData:N,updateReportData:k,addNotification:C}=e(),[w,I]=x.useState(null),[R,S]=x.useState(null),[$,T]=x.useState(!1),[z,U]=x.useState("all"),[A,D]=x.useState("all"),E=N.issues||[],O=e=>{k("issues",e)},L=[{value:"critical",label:"Critical",color:"red"},{value:"high",label:"High",color:"orange"},{value:"medium",label:"Medium",color:"yellow"},{value:"low",label:"Low",color:"blue"}],P=[{value:"open",label:"Open",color:"red"},{value:"in-progress",label:"In Progress",color:"yellow"},{value:"resolved",label:"Resolved",color:"green"},{value:"closed",label:"Closed",color:"gray"}],M=()=>{I({id:Date.now(),title:"",description:"",category:"",severity:"medium",status:"open",location:"",affectedUsers:"",reportedBy:"",assignedTo:"",dateReported:(new Date).toISOString().split("T")[0],dateResolved:"",resolution:"",estimatedCost:"",notes:""})},B=()=>{if(0===E.length)return 100;const e=E.filter(e=>"resolved"===e.status||"closed"===e.status).length;return Math.round(e/E.length*100)},H=e=>{const s={critical:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",high:"bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-300",medium:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",low:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"};return s[e]||s.medium},W=e=>{const s={open:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300","in-progress":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300",resolved:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",closed:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"};return s[e]||s.open},q=e=>{const t={open:s.jsx(y,{size:16}),"in-progress":s.jsx(f,{size:16}),resolved:s.jsx(b,{size:16}),closed:s.jsx(b,{size:16})};return t[e]||t.open},F=E.filter(e=>{const s="all"===z||e.status===z,t="all"===A||e.severity===A;return s&&t}),G=B();return s.jsxs("div",{className:"space-y-6",children:[s.jsx(t,{title:"Issues Resolution Progress",icon:s.jsx(u,{className:"text-blue-500"}),children:s.jsxs("div",{className:"space-y-4",children:[s.jsx(a,{progress:G,label:"Issues Resolution Rate",color:G>=80?"green":G>=50?"yellow":"red",size:"lg"}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"text-center p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[s.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:E.length}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Total Issues"})]}),s.jsxs("div",{className:"text-center p-3 bg-red-50 dark:bg-red-900/20 rounded-lg",children:[s.jsx("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:E.filter(e=>"open"===e.status).length}),s.jsx("p",{className:"text-xs text-red-500 dark:text-red-400",children:"Open"})]}),s.jsxs("div",{className:"text-center p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg",children:[s.jsx("p",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400",children:E.filter(e=>"in-progress"===e.status).length}),s.jsx("p",{className:"text-xs text-yellow-500 dark:text-yellow-400",children:"In Progress"})]}),s.jsxs("div",{className:"text-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[s.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:E.filter(e=>"resolved"===e.status||"closed"===e.status).length}),s.jsx("p",{className:"text-xs text-green-500 dark:text-green-400",children:"Resolved"})]})]})]})}),s.jsx(t,{title:"Issues & Problems Management",icon:s.jsx(m,{className:"text-red-500"}),helpText:"Document, track, and manage issues discovered during your office visit.",children:s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-wrap gap-3 justify-between items-center",children:[s.jsxs("div",{className:"flex flex-wrap gap-3",children:[s.jsxs(l,{value:z,onChange:e=>U(e.target.value),className:"w-auto",children:[s.jsx("option",{value:"all",children:"All Statuses"}),P.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))]}),s.jsxs(l,{value:A,onChange:e=>D(e.target.value),className:"w-auto",children:[s.jsx("option",{value:"all",children:"All Severities"}),L.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))]})]}),s.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.jsxs(r,{onClick:M,size:"sm",children:[s.jsx(p,{size:16}),"Add Issue"]}),s.jsxs(r,{onClick:()=>T(!0),variant:"outline",size:"sm",disabled:0===E.length,children:[s.jsx(h,{size:16}),"Email Report"]})]})]}),F.length>0?s.jsx("div",{className:"space-y-4",children:F.map(e=>s.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-600 shadow-sm",children:s.jsxs("div",{className:"flex justify-between items-start mb-4",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("h4",{className:"font-semibold text-gray-900 dark:text-gray-100 text-lg",children:e.title}),s.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${H(e.severity)}`,children:e.severity.toUpperCase()}),s.jsxs("span",{className:`px-2 py-1 rounded-full text-xs font-medium flex items-center gap-1 ${W(e.status)}`,children:[q(e.status),e.status.replace("-"," ").toUpperCase()]})]}),s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mb-3",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"Category:"}),s.jsx("span",{className:"ml-1 text-gray-900 dark:text-gray-100",children:e.category||"Not specified"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"Location:"}),s.jsx("span",{className:"ml-1 text-gray-900 dark:text-gray-100",children:e.location||"Not specified"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"Reported:"}),s.jsx("span",{className:"ml-1 text-gray-900 dark:text-gray-100",children:e.dateReported})]}),e.affectedUsers&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium text-gray-600 dark:text-gray-400",children:"Affected Users:"}),s.jsx("span",{className:"ml-1 text-gray-900 dark:text-gray-100",children:e.affectedUsers})]})]}),e.description&&s.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-3",children:e.description}),e.resolution&&s.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-3 mb-3",children:[s.jsxs("p",{className:"text-sm text-green-800 dark:text-green-200",children:[s.jsx("strong",{children:"Resolution:"})," ",e.resolution]}),e.dateResolved&&s.jsxs("p",{className:"text-xs text-green-600 dark:text-green-300 mt-1",children:["Resolved on: ",e.dateResolved]})]})]}),s.jsxs("div",{className:"ml-4 flex space-x-2",children:[s.jsx(r,{size:"sm",variant:"outline",onClick:()=>(e=>{I({...e})})(e),children:s.jsx(v,{size:16})}),s.jsx(r,{size:"sm",variant:"danger",onClick:()=>S(e),children:s.jsx(j,{size:16})})]})]})},e.id))}):s.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[s.jsx(m,{size:48,className:"mx-auto mb-4 opacity-50"}),s.jsx("p",{className:"text-lg font-medium mb-2",children:"all"!==z||"all"!==A?"No issues match the current filters":"No issues reported yet"}),s.jsx("p",{className:"text-sm mb-4",children:"all"!==z||"all"!==A?"Try adjusting your filters to see more issues":"Start documenting issues and problems found during your visit"}),s.jsxs(r,{onClick:M,children:[s.jsx(p,{size:16}),"Report First Issue"]})]})]})}),s.jsxs(i,{isOpen:!!w,onClose:()=>I(null),title:(w?.id&&E.find(e=>e.id===w.id)?"Edit":"Add")+" Issue",size:"xl",children:[w&&s.jsxs("div",{className:"space-y-4",children:[s.jsx(n,{label:"Issue Title *",value:w.title,onChange:e=>I({...w,title:e.target.value}),placeholder:"Enter a descriptive title for the issue",required:!0}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs(l,{label:"Category",value:w.category,onChange:e=>I({...w,category:e.target.value}),children:[s.jsx("option",{value:"",children:"Select Category"}),["Hardware","Software","Network","Security","User Access","Performance","Data Management","Backup & Recovery","Documentation","Training","Compliance","Other"].map(e=>s.jsx("option",{value:e,children:e},e))]}),s.jsx(l,{label:"Severity",value:w.severity,onChange:e=>I({...w,severity:e.target.value}),children:L.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(l,{label:"Status",value:w.status,onChange:e=>I({...w,status:e.target.value}),children:P.map(e=>s.jsx("option",{value:e.value,children:e.label},e.value))}),s.jsx(n,{label:"Location",value:w.location,onChange:e=>I({...w,location:e.target.value}),placeholder:"Where was this issue found?"})]}),s.jsx(g,{label:"Description",value:w.description,onChange:e=>I({...w,description:e.target.value}),placeholder:"Detailed description of the issue...",rows:3}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(n,{label:"Affected Users",value:w.affectedUsers,onChange:e=>I({...w,affectedUsers:e.target.value}),placeholder:"Number or list of affected users"}),s.jsx(n,{label:"Estimated Cost",value:w.estimatedCost,onChange:e=>I({...w,estimatedCost:e.target.value}),placeholder:"Cost to resolve (optional)"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(n,{label:"Reported By",value:w.reportedBy,onChange:e=>I({...w,reportedBy:e.target.value}),placeholder:"Who reported this issue?"}),s.jsx(n,{label:"Assigned To",value:w.assignedTo,onChange:e=>I({...w,assignedTo:e.target.value}),placeholder:"Who is responsible for fixing this?"})]}),("resolved"===w.status||"closed"===w.status)&&s.jsxs(s.Fragment,{children:[s.jsx(g,{label:"Resolution",value:w.resolution,onChange:e=>I({...w,resolution:e.target.value}),placeholder:"How was this issue resolved?",rows:3}),s.jsx(n,{label:"Date Resolved",type:"date",value:w.dateResolved,onChange:e=>I({...w,dateResolved:e.target.value})})]}),s.jsx(g,{label:"Additional Notes",value:w.notes,onChange:e=>I({...w,notes:e.target.value}),placeholder:"Any additional notes or observations...",rows:2})]}),s.jsxs("div",{className:"flex justify-end space-x-3 mt-6",children:[s.jsx(r,{variant:"outline",onClick:()=>I(null),children:"Cancel"}),s.jsx(r,{onClick:()=>{if(!w.title.trim())return void C({type:"error",message:"Issue title is required",duration:3e3});let e;e=w.id&&E.find(e=>e.id===w.id)?E.map(e=>e.id===w.id?w:e):[...E,{...w,id:Date.now()}],O(e),I(null),C({type:"success",message:"Issue saved successfully",duration:3e3})},children:"Save Issue"})]})]}),s.jsx(i,{isOpen:$,onClose:()=>T(!1),title:"Email Issues Report",size:"lg",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs(o,{variant:"info",children:[s.jsx("strong",{children:"Email Recipients:"}),s.jsx("br",{}),(d.issues||d.default).join(", ")]}),s.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Report Summary:"}),s.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[s.jsxs("div",{children:["Total Issues: ",E.length]}),s.jsxs("div",{children:["Open Issues: ",E.filter(e=>"open"===e.status).length]}),s.jsxs("div",{children:["Critical Issues: ",E.filter(e=>"critical"===e.severity).length]}),s.jsxs("div",{children:["Resolution Progress: ",G,"%"]})]})]}),s.jsxs("div",{className:"flex justify-end space-x-3",children:[s.jsx(r,{variant:"outline",onClick:()=>T(!1),children:"Cancel"}),s.jsxs(r,{onClick:()=>{const{mailtoLink:e}=(()=>{const e=N.office||"Office Visit",s=N.date||(new Date).toISOString().split("T")[0],t=`Issues Report - ${e} - ${s}`;let a="Issues & Problems Report\n";a+=`Office: ${e}\n`,a+=`Date: ${s}\n`,a+=`Report Generated: ${(new Date).toLocaleString()}\n\n`;const l=E.filter(e=>"open"===e.status),r=E.filter(e=>"critical"===e.severity);a+="SUMMARY:\n",a+=`Total Issues: ${E.length}\n`,a+=`Open Issues: ${l.length}\n`,a+=`Critical Issues: ${r.length}\n`,a+=`Resolution Progress: ${B()}%\n\n`,r.length>0&&(a+="CRITICAL ISSUES:\n",r.forEach(e=>{a+=`\n• ${e.title}\n`,a+=`  Category: ${e.category}\n`,a+=`  Status: ${e.status}\n`,a+=`  Location: ${e.location}\n`,e.description&&(a+=`  Description: ${e.description}\n`)}),a+="\n"),l.length>0&&(a+="ALL OPEN ISSUES:\n",l.forEach(e=>{a+=`\n• ${e.title}\n`,a+=`  Severity: ${e.severity}\n`,a+=`  Category: ${e.category}\n`,a+=`  Location: ${e.location}\n`,e.affectedUsers&&(a+=`  Affected Users: ${e.affectedUsers}\n`),e.estimatedCost&&(a+=`  Estimated Cost: ${e.estimatedCost}\n`)}));const i=d.issues||d.default;return{mailtoLink:`mailto:${i.join(",")}?subject=${encodeURIComponent(t)}&body=${encodeURIComponent(a)}`,subject:t,body:a,recipients:i}})();window.location.href=e,T(!1),C({type:"success",message:"Email client opened with issues report",duration:3e3})},children:[s.jsx(h,{size:16}),"Send Email"]})]})]})}),s.jsx(c,{isOpen:!!R,onClose:()=>S(null),onConfirm:()=>(e=>{const s=E.filter(s=>s.id!==e);O(s),S(null),C({type:"info",message:"Issue deleted successfully",duration:3e3})})(R?.id),title:"Delete Issue",message:`Are you sure you want to delete "${R?.title}"? This action cannot be undone.`,confirmText:"Delete Issue",cancelText:"Cancel",variant:"danger"})]})};export{N as default};
